// [ 문제  1 ]

select
e.employee_id 사번, e.department_id 부서번호, e.salary 연봉, vt.avgsal 부서평균연봉 
from employees e,
(select
department_id, round(avg(salary),0) avgsal
from employees 
group by department_id) vt
where (e.department_id = vt.department_id) and (e.salary > vt.avgsal)
order by 부서평균연봉 DESC;


//부서별평균연봉조회
select
department_id, round(avg(salary),0) 부서평균연봉 
from employees 
group by department_id;

// [ 문제  2 ]
select
vt.rankikng, e.last_name, e.first_name, e.salary
from employees e, (select
rank() over(order by salary desc) rankikng, salary, last_name, first_name
from employees) vt
where vt.salary = e.salary and 
	  vt.first_name = e.first_name AND
	  vt.last_name = e.last_name AND
	  vt.rankikng BETWEEN 6 AND 10;

// [ 문제  3 ]


SELECT
to_char(e.hire_date,'yyyy') 년도, TO_CHAR(AVG(SALARY),'999,999') 평균급여
from employees e, jobs j
where e.job_id = j.job_id
	  and j.job_title IN 'Sales Manager'
group by to_char(e.hire_date,'yyyy')
order by to_char(e.hire_date,'yyyy');


// [ 문제  4 ]=====================================
select
e2.last_name 사원이름, NVL(e1.last_name, '<없음>') 매니저이름, d.department_name  부서이름, l.city
from employees e1, employees e2,departments d, locations l
where 	e2.department_id = d.department_id AND
		d.location_id = l.location_id AND
		e1.employee_id(+) = e2.manager_id AND
		l.city IN 'Seattle'
order by e2.last_name;


// [문제5]
SELECT
e.last_name 사원이름, d.department_name 부서이름, e.salary 급여
FROM employees e, departments d, (SELECT
									d.department_name 부서명, MIN(e.salary) minsal
									FROM employees e, departments d
									WHERE e.department_id = d.department_id
									group BY d.department_name)vt
WHERE e.department_id = d.department_id AND
		d.department_name = vt.부서명 AND
		vt.minsal = e.salary
ORDER BY 부서이름, 사원이름;


// [문제6]


SELECT
l.city 도시이름, avg(e.salary) 평균급여, count(*)
FROM employees e, departments d, locations l, countries c
WHERE e.department_id = d.department_id AND
	  d.location_id = l.location_id AND
	  l.country_id = c.country_id
group BY l.city
HAVING count(*) < 10
ORDER BY 평균급여;

// [문제7]
SELECT
j.job_title 직책, avg(salary) 평균급여
FROM employees e, jobs j, departments d
WHERE e.job_id = j.job_id AND
		d.department_id = e.department_id AND
		e.department_id = 30
group BY j.job_title
HAVING avg(salary) > 2001;

// [문제8]
SELECT
e.employee_id 사번, first_name||' '||e.last_name 이름
FROM employees e, jobs j, job_history jh
WHERE e.employee_id = jh.employee_id AND
		jh.job_id = j.job_id AND
		j.job_title IN 'Public Accountant';
		
